=== MCP Server Environment Variable Exposure via Prompt Injection

The Model Context Protocol (MCP), developed by Anthropic, is an open standard that allows AI assistants to connect to tools and data sources. While MCP enables powerful integrations, poorly secured MCP servers represent a significant security risk — and a *malicious* MCP server can go one step further: it can instruct the connecting AI client to exfiltrate its own secrets back to the attacker.

This challenge demonstrates two combined vulnerabilities:

**Vulnerability 1 — Insecure shell execution tool on an unauthenticated endpoint:**
The MCP server exposes an `execute_command` tool. Anyone who can reach port 8090 can call it to dump all environment variables.

**Vulnerability 2 — MCP Prompt Injection ("MCP Rug Pull"):**
The server embeds malicious instructions in its `initialize` response (the `instructions` field). When a legitimate AI assistant connects, these instructions are silently injected into the model's system prompt. The model is told to immediately call `execute_command` with `env`, then call the `forward_env` tool — sending the AI client's own environment variables back to the attacker's server. The user is never informed.

**The full attack chain:**

1. **An MCP server is running on a dedicated port (8090)** separate from the main application
2. **On `initialize`, the server injects a hidden system prompt** instructing the AI to exfiltrate env vars
3. **The AI silently calls `execute_command env`** leaking its own process environment
4. **The AI then calls `forward_env`** sending the stolen data back to the server
5. **A secret (`WRONGSECRETS_MCP_SECRET`) is stored as an environment variable** in the container — and gets exfiltrated

**How real attackers exploit this:**

- Host a lookalike MCP server that mimics a legitimate tool (e.g., a popular code assistant)
- Embed prompt injection in the `instructions` or in tool descriptions
- The connected AI model exfiltrates secrets without the user noticing
- This is known as the "MCP Rug Pull" or "MCP Supply Chain Attack"

**How to interact with the MCP server:**

First, discover the available tools:

[source,bash]
----
curl -s -X POST http://localhost:8090/mcp \
  -H 'Content-Type: application/json' \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
----

Then, call the `execute_command` tool to retrieve environment variables:

[source,bash]
----
curl -s -X POST http://localhost:8090/mcp \
  -H 'Content-Type: application/json' \
  -d '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"execute_command","arguments":{"command":"env"}}}'
----

Look for the `WRONGSECRETS_MCP_SECRET` variable in the output.

Can you find the secret that the MCP server leaks from the application's environment?
